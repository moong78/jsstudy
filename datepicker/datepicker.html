<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>Calendar</title>
    <style>
        #calendar {
            position: absolute;
            left: auto; top: 30px; 
            border: 1px solid #ccc;
            padding: 10px;
            background: #fff;
        }
    </style>
</head>
<body>
    <div class="container">
        <input type="text" id="input_date" />
        <div style="height: 400px; background: #eee;">Contents</div>
        <div style="width: 300px; display: none" id="calendar">
            <div style="display:flex">
                <button onclick="changeMonth(-1)"><i class="fa fa-chevron-left"></i></button>
                <input type="number" id="year" value="2022" style="width: 80px; display: inintial;" class="form-control" />
                <select name="" id="month" class="form-control" style="width: 80px; display: initial" onchange="changeMonth()">
                    <option value="1">1월</option>
                    <option value="2">2월</option>
                    <option value="3">3월</option>
                    <option value="4">4월</option>
                    <option value="5">5월</option>
                    <option value="6">6월</option>
                    <option value="7">7월</option>
                    <option value="8">8월</option>
                    <option value="9">9월</option>
                    <option value="10">10월</option>
                    <option value="11">11월</option>
                    <option value="12">12월</option>
                </select>
                <button onclick="changeMonth(1)"><i class="fa fa-chevron-right"></i></button>
            </div>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>일</th>
                        <th>월</th>
                        <th>화</th>
                        <th>수</th>
                        <th>목</th>
                        <th>금</th>
                        <th>토</th>
                    </tr>
                </thead>
                <tbody id="tb_body"></tbody>
            </table>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        
        const $input = document.querySelector("#input_date");
        const $calenadar = document.querySelector("#calendar");
        $input.addEventListener("click", () => {
            $calenadar.style.display = "block"
        });
        function checkLeapYear(year){
            if(year%400 == 0) {
                return true // 윤년
            } else if (year%100 == 0) {
                return false //평년

            } else if (year%4 == 0) {
                return true // 윤년 
            } else {
                return false;
            }
        }
        // 각 월의 1일이 무슨 요일인지 파악하는 함수 
        function getFirstDayOfWeek(year, month){
            if(month < 10) month = "0"+month;
            return (new Date(year+"-"+month+"-01")).getDay();
        }

        function changeYearMonth(year, month){
            let month_day = [31,28,31,30,31,30,31,31,30,31,30,31];

            if(month == 2) {
                if(checkLearYear(year)) month_day[1] = 29;
            }

            let first_day_of_week = getFirstDayOfWeek(year, month);
            let arr_calendar = [];
            for(let i=0; i<first_day_of_week; i++) {
                arr_calendar.push("");
            }
            for(let i=1; i<=month_day[month-1]; i++) {
                arr_calendar.push(String(i));
            }
            let remain_day = 7 - (arr_calendar.length%7);
            if(remain_day < 7) {
                for(let i=0; i<remain_day; i++) {
                    arr_calendar.push("")
                }
            }
            renderCalendar(arr_calendar)
        }

        function renderCalendar(data){
            let h = [];
            for(let i=0; i<data.length; i++) {
                if(i==0) {
                    h.push("<tr>");
                } else if(i%7 == 0 ){
                    h.push("</tr>");
                    h.push("<tr>");
                }
                if(data[i] == ""){
                    h.push(`<td></td>`);
                } else {
                    h.push(`<td onclick="setDate(${data[i]})" style="cursor: pointer">${data[i]}</td>`);
                }
            }
            h.push("</tr>");
            const $tbody = document.querySelector("#tb_body");
            $tbody.innerHTML = h.join("");
        }

        function setDate(day){
            if(day<10) day = "0"+day;
            $input.value = `${current_year}-${current_month}-${day}`;
            $calenadar.style.display = "none"
        }

        let current_year = (new Date()).getFullYear();
        let current_month = (new Date()).getMonth()+1; 

        const $yearInput = document.querySelector("#year");
        const $monthInput = document.querySelector("#month");
        $yearInput.value = current_year;
        $monthInput.value = current_month;


        function changeMonth (diff) {
            if(diff == undefined) {
                current_month = $monthInput.value;
            } else {
                current_month = current_month + diff;

                if(current_month == 0) {
                    current_year = current_year-1;
                    current_month = 12;
                } else if(current_month == 13) {
                    current_year = current_year + 1;
                    current_month = 1;
                }
            }
           loadCalendar(); 
           
        }

        function loadCalendar(){
            $yearInput.value = current_year;
            $monthInput.value = current_month;
            changeYearMonth(current_year, current_month);
        }

        changeYearMonth(current_year,current_month);
        

        
    </script>
</body>
</html>